# 株式会社オトバンク

2019 年 9 月に入社した。書籍を朗読した音声データ、オーディオブックを取り扱っている。そのオーディオブックを再生・販売するアプリ（[App Store](https://apps.apple.com/JP/app/id1357581573?mt=8), [Google Play](https://play.google.com/store/apps/details?id=jp.audiobook.app)）を開発する。iOS, Android 向けとも React Native で作成されている。開発担当した事例の一部を列挙する。

## 主な技術スタック

### React Native 関連

- TypeScript
- RxJS
- Redux Saga
- Watermelon DB
- React Navigation
- React Native Paper
- Firebase
- Expo（Bare workflow）
- Jest

### コード管理

- GitHub

### CI

- Bitrise

## React Native

React Native で iOS および Android アプリの開発をしている。React Native は未経験で入社して、業務開発をしながら、勉強していった。また、React Native では実装できない再生機能などの iOS および Android それぞれのネイティブ機能の実装（Swift, Kotlin）の開発も行っている。

### 開発進行

- 開発スタイル
  - PM、デザイナー、サーバーサイドエンジニア、アプリエンジニアの少人数チームで行う
  - 当初はスクラムだったが、人が少なく上手く回らなかったので、厳密なスクラムではない
  - 後述の ver. 2 への大規模な改修をしたときは PM とアプリエンジニアでウォーターフォールを採用した
- エンジニアチーム
  - 小規模な機能開発は原則１人のエンジニアで行っている
  - コードレビューはプロジェクトやチームを越えてエンジニアチーム全体で行っている
  - 大規模改修は社員 3 人と業務委託 1 人のエンジニア 4 人で開発した

## リモートワーク（2019/12 - 退職まで）

コロナ禍の前よりリモートワークが可能だったが、完全に出社しないフルリモートワーク希望の社員は私がはじめてだったので、最初の３ヶ月ほど本社に出社した。その後は、山口県に戻り、フルリモートで勤務している。Slack や Google meets などのツールを利用して、コミュニケーションを取りながら、問題なく開発をしている。社内業務で東京出張したこともあったが、コロナ禍に入ってからは本社へ出社はしていない。開発中は集中したいので、リモートワークでの開発は私に適している。

### コードメンテナー（2021/10 - 退職まで）

React Native がネイティブ側の仕様や機能変更を管理・調整してくれるのもあり、そのアップデートは React Native 開発での重要な作業になる。メンテを主に担当してた前任者の退職に伴い、その作業を引き継いでいる。約１,２か月ごとのアップデートや、導入ライブラリのメンテを行っている。

### アプリ内課金関連の改修（2021/09 - 2021/11）

PM よりアプリ内課金の価格変更やプラン追加、アプリ内の LP の変更をアプリ外から制御する機能追加の案件を受けて、開発を始めた。価格変更はサービス開始からはじめてだったので、製品 ID やアプリ内課金の LP がハードコーディングされてた。また、サーバー側の改修も必要で、中長期の開発が予想された。そこで、案件の分割を提案し、３つに分けて開発した。

1. LP を WebView 化する。アプリの改修なしで、LP の表示変更ができるようになった。
1. 価格を変更する。製品 ID を API で取得できるように変更した。
1. 価格（プラン）を追加した。プランの切り替えや復元処理を新しい仕様に合わせて修正した。

分けることによって、その都度リリースできたので、早期リリースに貢献した。なお、課金実装は、iOS と Android で仕様が異なるため、テストコードを増やして、慎重に開発した。

### ver. 2 への大規模改修（2020/09 - 2021/07）

ver. 1 アプリは私の入社前からあり、当時在籍していたサーバーサイドエンジニアが設計していた。アプリ設計を考慮した設計ではなかったため、このままで機能改修を続けていくと破綻するとアプリチームは日々考えていた。そこで、アプリチームから社内へ提案・説得して、開発が始まった。

- モダンなコンポーネント
  - 従来はクラスコンポーネントで定義されていたが、お世辞にも使い勝手のよいものではなかった（私が入社直後に悩まされた原因の１つ）
  - モダンな関数コンポーネントにすべて置き換え、開発体験を改善した
- ダークテーマ
  - 元々カラーテーマなどを考慮していなかったので、この改修に関する機能提案の会議ですぐさま提案して追加機能に組み込んだ
- データベースの一新
  - ライブラリの安定性・更新頻度に難色があったので、データベースの入れ替えを行なった。

当初は半年程度の改修を想定していたが、ソースコードにしかない仕様の発見など、いろいろ問題はあり、予定より延びてしまった。しかし、リリースできた ver.2 のおかげて、その後の開発体験は向上した。

### Spotlight 機能（2020/05）

iPhone 内の検索バー（ホーム画面の最左の画面や、下スワイプをしたときに表示される）の検索結果は、アプリ内のデータと反映させることができる。その機能と自社アプリの相性はよいと考え、自身で機能提案を出して、 実装を行なった。

React Native には Spotlight を実現するライブラリは提供されていなかった。そのため自身で React Native とネイティブ機能を連携されるための Native Module を作成した。また、その Native Module はアプリ本体のリポジトリとは別にして Github Packages にて管理するようにして、自社ライブラリ保守の向上に取り組んだ。

### Sign in with Apple（2020/04）

Apple の審査ガイドライン改定により Sign in with Apple が必須となったので、実装を行なった。これまで Native Module で実装してたが、今回はすでに [react-native-apple-authentication](https://github.com/invertase/react-native-apple-authentication) というライブラリが公開されていたので、こちらを利用した。しかしながら、一部で問題があったので、issue でコメントしたのち、機能修正の PR を送り、機能修正を行った。

### Siri Media Intents（2019/11 - 2019/12）

ボイスコントール機能「Hey Siri, XXX をオーディブックで再生して」を実装した。国内のネイティブ開発でも Siri 機能の開発事例は少なく、当初はノウハウがなく困難だった。このとき、Apple Japan の DevRel と知り合い、Apple 本社の SiriKit エンジニアと直接会える機会を用意してもらい、いろいろとアドバイスをもらえた。

Apple の協力もあり、Siri 機能の Native Module が完成して、アプリに組み込み、「Hey Siri, XXX をオーディブックで再生して」が動くようになった。しかしながら、Siri は日々サイレントアップデートをしているように見えて、昨日は動いていたが今日は動かないこともある。Apple へフィードバックを送ったり、Native Module の調整した。
